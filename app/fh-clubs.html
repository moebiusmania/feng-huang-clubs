<!-- Imports polymer -->
<link rel="import" href="./bower_components/polymer/polymer.html">
<link rel="import" href="./bower_components/google-map/google-map.html">
<link rel="import" href="./bower_components/clab-ui-components/input/view.html">
<link rel="import" href="./bower_components/clab-ui-components/card/view.html">

<link rel="stylesheet" href="./bower_components/clab-ui-components/_assets/css/contactlab-pattern.css">

<!-- Defines element markup -->
<dom-module id="feng-huang-clubs">
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,700' rel='stylesheet' type='text/css'>
    <style>

      .contain{
        padding: 20px;
      }

      google-map{
        height: 450px;
      }

    </style>
    <template>

      <div class="contain">
        <input-clab
          label="[[_computeText(clubs)]]"
          on-keyup="_filterClubs"
          value="{{search::keyup}}"
          placeholder="Milano, Pavia, ...">
        </input-clab>
      </div>

      <google-map api-key="[[key]]" latitude="[[latitude]]" longitude="[[longitude]]"
      fit-to-markers disable-zoom max-zoom="15" min-zoom="10" single-info-window>
        <template is="dom-repeat" items="[[list]]">
          <google-map-marker latitude="[[item.latitude]]" longitude="[[item.longitude]]"
          title="[[item.name]]" animation="DROP" on-google-map-marker-click="_test"
          click-events data-index$="[[index]]"
          ></google-map-marker>
            <!-- <img style="display: block;" src="[[item.logo]]" alt="[[item.name]]"
            width="200" height="200px">
              <strong><a href="[[item.url]]" style="color: #FD2626" target="_blank">[[item.name]]</a></strong><br>
              <small>[[item.city]]</small> -->
          </google-map-marker>
        </template>
      </google-map>

      <div class="contain">
        <template is="dom-repeat" items="[[list]]">
          <card-clab
            title="[[item.name]]">
              <p>[[item.city]]</p>
          </card-clab>
          <!-- <paper-card image="[[item.logo]]">
            <div class="card-content">
              <h3>[[item.name]]</h3>
              <p>[[item.city]]</p>
            </div>
            <div class="card-actions">
              <paper-button data-index$="[[index]]" on-click="_goToUrl">Pagina del sito</paper-button>
            </div>
          </paper-card> -->
        </template>
      </div>

    </template>

    <!-- Registers custom element -->
    <script>
    Polymer({
        is: 'feng-huang-clubs',
        properties: {
          key: {
            type: String,
            value: "AIzaSyD6Ltm32QJIxRFDSdWyQ6--2Y_j0YxEwlg"
          },
          latitude: {
            type: String,
            value: 45.4737012
          },
          longitude: {
            type: String,
            value: 9.1908025
          },
          search: {
            type: String,
            notify: true
          },
          list: {
            type: Array,
            value: []
          },
          clubs: {
            type: Array,
            value: [
              {
                name: "Tang Lang",
                city: "Pieve Emanuele (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Tang-Lan-Chuan.png",
                latitude: 45.35068,
                longitude: 9.20059,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/pieve-emanuele-milano-sud"
              },{
                name: "Yĩng Bũ Zhàng Chì",
                city: "Lacchiarella (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Yuin-Bu-Zhang-Chi.png",
                latitude: 45.323792,
                longitude: 9.140073,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-lacchiarella-milano"
              },{
                name: "Mat Troi Dang Len",
                city: "Milano (Famagosta)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Mat-Troi-Dan-Len.png",
                latitude: 45.432146,
                longitude: 9.157363,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-milano-famagosta"
              },{
                name: "Long Ho",
                city: "Landriano (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Long-Ho.png",
                latitude: 45.312194,
                longitude: 9.259746,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/kung-fu-landriano-pavia"
              },{
                name: "Da Cam Thach",
                city: "Pero (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Da-Cam-Thach.png",
                latitude: 45.509823,
                longitude: 9.089452,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-pero"
              },{
                name: "Pa Chi Chuan",
                city: "Zenone Al Lambro (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-club-placeholder.png",
                latitude: 45.326934,
                longitude: 9.357902,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-zenone-al-lambro"
              },{
                name: "Nghich ma cuoc",
                city: "Torrevecchia Pia (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-Nghich-ma-cuoc.png",
                latitude: 45.283727,
                longitude: 9.298005,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-torrevecchia-pia"
              },{
                name: "Yun Chi",
                city: "Rozzano (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-Yun-Chi-Rozzano.png",
                latitude: 45.378776,
                longitude: 9.154653,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-rozzano"
              },{
                name: "Ho Trao",
                city: "San Giuliano Milanese (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Ho-Trao.png",
                latitude: 45.395334,
                longitude: 9.288501,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-san-giuliano-milanese"
              },{
                name: "Shoen",
                city: "Senago (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Shoen.png",
                latitude: 45.574262,
                longitude: 9.118499,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-senago"
              }
            ]
          }
        },

        // Fires when the element was inserted into the document
        attached: function() {
          this.list = this.clubs;
        },

        _test(evt){
          console.log('ok');
        },

        _computeText(clubs){
          return 'Cerca tra i ' + clubs.length + ' club della scuola Feng Huang (per nome o paese)'
        },

        _goToUrl: function(evt){
          var i = parseInt(evt.currentTarget.dataset.index);
          window.location.href = this.list[i].url;
        },

        _filterClubs(evt){
          var str = evt.target.value;
          console.log(str);
          str.length == 0 ? this.list = this.clubs : this.list = this.clubs.filter(function(club){
            return (club.name.toLowerCase().search(str) > -1) ||
              (club.city.toLowerCase().search(str) > -1);
          });
        }

    });
    </script>
</dom-module>
