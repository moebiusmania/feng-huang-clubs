<!-- Imports polymer -->
<!-- <link rel="import" href="bower_components/polymer/polymer.html"> -->
<link rel="import" href="bower_components/google-map/google-map.html">
<link rel="import" href="bower_components/clab-ui-components/_components/clab-ui-components.html">
<!-- <link rel="import" href="bower_components/clab-ui-components/input/view.html">
<link rel="import" href="bower_components/clab-ui-components/card/view.html"> -->


<!-- Defines element markup -->
<dom-module id="feng-huang-clubs">
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,700' rel='stylesheet' type='text/css'>
    <style>

      .contain{
        padding: 20px;
        display: flex;
        justify-content: flex-start;
        flex-wrap: wrap;
      }

      .contain card-clab{
        width: 300px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      /*.contain card-clab:hover{
        box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.2);
        transform: scale(1.05);
        z-index: 10;
      }*/

      /*:host card-clab div.card figure h2 {
        color: #FD2626;
      }

      card-clab figure{
        background-color: #2C2D30 !important;
        background-image: url("http://www.fenghuang.org/templates/fenghuang/images/sheet.png");
      }*/

      google-map{
        height: 450px;
        border-top: 1px solid rgba(0,0,0,0.2);
        border-bottom: 1px solid rgba(0,0,0,0.2);
      }

    </style>
    <template>

      <div class="contain">
        <input-clab
          label="[[_computeText(clubs)]]"
          on-keyup="_filterClubs"
          value="{{search::keyup}}"
          placeholder="Milano, Pavia, ...">
        </input-clab>
      </div>

      <google-map api-key="[[key]]" latitude="[[latitude]]" longitude="[[longitude]]"
      fit-to-markers disable-zoom max-zoom="15" min-zoom="10" single-info-window>
        <template is="dom-repeat" items="[[list]]">
          <google-map-marker latitude="[[item.latitude]]" longitude="[[item.longitude]]"
          title="[[item.name]]" animation="DROP" on-google-map-marker-click="_test"
          click-events data-index$="[[index]]"
          ></google-map-marker>
          </google-map-marker>
        </template>
      </google-map>

      <div class="contain">
        <template is="dom-repeat" items="[[list]]">
          <card-clab
            data-index$="[[index]]"
            title="[[item.name]]"
            primary="Pagina del sito"
            secondary="Google Maps"
            effect="saturation"
            figure="[[item.logo]]">
              <p>[[item.city]]</p>
          </card-clab>
        </template>
      </div>

    </template>

    <!-- Registers custom element -->
    <script>
    Polymer({
        is: 'feng-huang-clubs',
        properties: {
          key: {
            type: String,
            value: "AIzaSyD6Ltm32QJIxRFDSdWyQ6--2Y_j0YxEwlg"
          },
          latitude: {
            type: String,
            value: 45.4737012
          },
          longitude: {
            type: String,
            value: 9.1908025
          },
          search: {
            type: String,
            notify: true
          },
          list: {
            type: Array,
            value: []
          },
          clubs: {
            type: Array,
            value: [
              {
                name: "Tang Lang",
                city: "Pieve Emanuele (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Tang-Lan-Chuan.png",
                latitude: 45.35068,
                longitude: 9.20059,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/pieve-emanuele-milano-sud"
              },{
                name: "Yĩng Bũ Zhàng Chì",
                city: "Lacchiarella (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Yuin-Bu-Zhang-Chi.png",
                latitude: 45.323792,
                longitude: 9.140073,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-lacchiarella-milano"
              },{
                name: "Mat Troi Dang Len",
                city: "Milano (Famagosta)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Mat-Troi-Dan-Len.png",
                latitude: 45.432146,
                longitude: 9.157363,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-milano-famagosta"
              },{
                name: "Long Ho",
                city: "Landriano (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Long-Ho.png",
                latitude: 45.312194,
                longitude: 9.259746,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/kung-fu-landriano-pavia"
              },{
                name: "Da Cam Thach",
                city: "Pero (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Da-Cam-Thach.png",
                latitude: 45.509823,
                longitude: 9.089452,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-pero"
              },{
                name: "Pa Chi Chuan",
                city: "Zenone Al Lambro (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-club-placeholder.png",
                latitude: 45.326934,
                longitude: 9.357902,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-zenone-al-lambro"
              },{
                name: "Nghich ma cuoc",
                city: "Torrevecchia Pia (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-Nghich-ma-cuoc.png",
                latitude: 45.283727,
                longitude: 9.298005,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-torrevecchia-pia"
              },{
                name: "Yun Chi",
                city: "Rozzano (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-Yun-Chi-Rozzano.png",
                latitude: 45.378776,
                longitude: 9.154653,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-rozzano"
              },{
                name: "Ho Trao",
                city: "San Giuliano Milanese (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Ho-Trao.png",
                latitude: 45.395334,
                longitude: 9.288501,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-san-giuliano-milanese"
              },{
                name: "Shoen",
                city: "Senago (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Shoen.png",
                latitude: 45.574262,
                longitude: 9.118499,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-senago"
              }
            ]
          }
        },

        // Fires when the element was inserted into the document
        attached: function() {
          this.list = this.clubs.sort(this._byName);
        },

        _byName(a,b){
          var textA = a.name.toUpperCase();
          var textB = b.name.toUpperCase();
          return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;
        },

        _computeText(clubs){
          return 'Cerca tra i ' + clubs.length + ' club della scuola Feng Huang (per nome o paese)'
        },

        _goToUrl: function(evt){
          var i = parseInt(evt.currentTarget.dataset.index);
          window.location.href = this.list[i].url;
        },

        _computeLink(link){
          var obj = {
            href: link,
            text: 'Apri nel sito'
          };
          return obj;
        },

        _filterClubs(evt){
          var str = evt.target.value;
          console.log(str);
          str.length == 0 ? this.list = this.clubs : this.list = this.clubs.filter(function(club){
            return (club.name.toLowerCase().search(str) > -1) ||
              (club.city.toLowerCase().search(str) > -1);
          });
        }

    });
    </script>
</dom-module>
