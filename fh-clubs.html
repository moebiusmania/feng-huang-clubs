<!-- Imports polymer -->
<link rel="import" href="./bower_components/polymer/polymer.html">
<link rel="import" href="./bower_components/google-map/google-map.html">
<link rel="import" href="./bower_components/paper-input/paper-input.html">
<link rel="import" href="./bower_components/paper-card/paper-card.html">
<link rel="import" href="./bower_components/paper-button/paper-button.html">
<link rel="import" href="./bower_components/iron-image/iron-image.html">


<!-- Defines element markup -->
<dom-module id="feng-huang-clubs">
    <style>
      :host{
        --paper-input-container-focus-color: #FD2626
      }
      google-map{
        height: 400px;
      }

      paper-card{
        margin: 10px 0;
        --paper-card: {
          width: 240px;
        }
        --paper-card-header: {
          background-color: #2C2D30;
          background-image: url("http://www.fenghuang.org/templates/fenghuang/images/sheet.png");
        }
      }
      paper-card h3{
        margin-top: 0;
        color: #FD2626;
      }
    </style>
    <template>

      <paper-input label="Cerca un club (per nome o paese)" on-keyup="_filterClubs"
        value="{{serach::keyup}}"
      ></paper-input>

      <google-map api-key="[[key]]" latitude="[[latitude]]" longitude="[[longitude]]"
      fit-to-markers zoom="15">
        <template is="dom-repeat" items="[[list]]">
          <google-map-marker latitude="[[item.latitude]]" longitude="[[item.longitude]]"
          title="[[item.name]]" animation="DROP" on-google-map-marker-click="_test">
            <img style="display: block;" src="[[item.logo]]" alt="[[item.name]]"
            width="200" height="200px">
            <!-- <paper-button style="display: block;" data-index$="[[index]]"> -->
              <strong><a href="[[item.url]]" style="color: #FD2626" target="_blank">[[item.name]]</a></strong><br>
              <small>[[item.city]]</small>
            <!-- </paper-button> -->
          </google-map-marker>
        </template>
      </google-map>

      <template is="dom-repeat" items="[[list]]">
        <paper-card image="[[item.logo]]">
          <div class="card-content">
            <h3>[[item.name]]</h3>
            <p>[[item.city]]</p>
          </div>
          <div class="card-actions">
            <paper-button data-index$="[[index]]" on-click="_goToUrl">Pagina del sito</paper-button>
          </div>
        </paper-card>
      </template>

    </template>

    <!-- Registers custom element -->
    <script>
    Polymer({
        is: 'feng-huang-clubs',
        properties: {
          key: {
            type: String,
            value: "AIzaSyD6Ltm32QJIxRFDSdWyQ6--2Y_j0YxEwlg"
          },
          latitude: {
            type: String,
            value: 45.4737012
          },
          longitude: {
            type: String,
            value: 9.1908025
          },
          search: {
            type: String,
            notify: true
          },
          list: {
            type: Array,
            value: []
          },
          clubs: {
            type: Array,
            value: [
              {
                name: "Tang Lang",
                city: "Pieve Emanuele (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Tang-Lan-Chuan.png",
                latitude: 45.35068,
                longitude: 9.20059,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/pieve-emanuele-milano-sud"
              },{
                name: "Yĩng Bũ Zhàng Chì",
                city: "Lacchiarella (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Yuin-Bu-Zhang-Chi.png",
                latitude: 45.323792,
                longitude: 9.140073,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-lacchiarella-milano"
              },{
                name: "Mat Troi Dang Len",
                city: "Milano (Famagosta)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Mat-Troi-Dan-Len.png",
                latitude: 45.432146,
                longitude: 9.157363,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/corso-milano-famagosta"
              },{
                name: "Long Ho",
                city: "Landriano (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Long-Ho.png",
                latitude: 45.312194,
                longitude: 9.259746,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/kung-fu-landriano-pavia"
              },{
                name: "Da Cam Thach",
                city: "Pero (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/Da-Cam-Thach.png",
                latitude: 45.509823,
                longitude: 9.089452,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-pero"
              },{
                name: "Pa Chi Chuan",
                city: "Zenone Al Lambro (Milano)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-club-placeholder.png",
                latitude: 45.326934,
                longitude: 9.357902,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-zenone-al-lambro"
              },{
                name: "Nghich ma cuoc",
                city: "Torrevecchia Pia (Pavia)" ,
                logo: "http://www.fenghuang.org/images/loghi-club/logo-Nghich-ma-cuoc.png",
                latitude: 45.283727,
                longitude: 9.298005,
                url: "http://www.fenghuang.org/kung-fu-milano-pavia/palestra-torrevecchia-pia"
              }
            ]
          }
        },

        // Fires when the element was inserted into the document
        attached: function() {
          this.list = this.clubs;
        },

        _goToUrl: function(evt){
          var i = parseInt(evt.currentTarget.dataset.index);
          window.location.href = this.list[i].url;
        },

        _filterClubs(evt){
          var str = evt.target.value;
          console.log(str);
          str.length == 0 ? this.list = this.clubs : this.list = this.clubs.filter(function(club){
            return (club.name.toLowerCase().search(str) > -1) ||
              (club.city.toLowerCase().search(str) > -1);
          });
        }

    });
    </script>
</dom-module>
